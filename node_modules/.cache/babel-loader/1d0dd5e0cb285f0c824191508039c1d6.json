{"ast":null,"code":"import * as n from \"react\";\nimport { createContext as r, forwardRef as e, useState as t, useImperativeHandle as u, createElement as o, useCallback as i, useContext as c } from \"react\";\nimport { tap as f, init as a, curry1to0 as l, subscribe as s, reset as v, always as d, publish as p, eventHandler as m, curry2to1 as y, getValue as h } from \"@virtuoso.dev/urx\";\nvar O = [\"children\"],\n    b = \"undefined\" != typeof document ? n.useLayoutEffect : n.useEffect;\n\nfunction j(j, g, k) {\n  var x,\n      E,\n      R,\n      P,\n      q = Object.keys(null != (x = g.required) ? x : {}),\n      C = Object.keys(null != (E = g.optional) ? E : {}),\n      w = Object.keys(null != (R = g.methods) ? R : {}),\n      L = Object.keys(null != (P = g.events) ? P : {}),\n      V = r({});\n\n  function z(n, r) {\n    void 0 !== n.propsReady && p(n.propsReady, !1);\n\n    for (var e = 0; e < q.length; e++) {\n      var t = q[e];\n      p(n[g.required[t]], r[t]);\n    }\n\n    for (var u = 0; u < C.length; u++) {\n      var o = C[u];\n      o in r && p(n[g.optional[o]], r[o]);\n    }\n\n    void 0 !== n.propsReady && p(n.propsReady, !0);\n  }\n\n  function A(n) {\n    return L.reduce(function (r, e) {\n      return r[e] = m(n[g.events[e]]), r;\n    }, {});\n  }\n\n  return {\n    Component: e(function (n, r) {\n      var e = n.children,\n          i = function (n, r) {\n        if (null == n) return {};\n        var e,\n            t,\n            u = {},\n            o = Object.keys(n);\n\n        for (t = 0; t < o.length; t++) r.indexOf(e = o[t]) >= 0 || (u[e] = n[e]);\n\n        return u;\n      }(n, O),\n          c = t(function () {\n        return f(a(j), function (n) {\n          return z(n, i);\n        });\n      }),\n          m = c[0],\n          y = t(l(A, m))[0];\n\n      return b(function () {\n        for (var n = 0; n < L.length; n++) {\n          var r = L[n];\n          r in i && s(y[r], i[r]);\n        }\n\n        return function () {\n          Object.values(y).map(v);\n        };\n      }, [i, y, m]), b(function () {\n        z(m, i);\n      }), u(r, d(function (n) {\n        return w.reduce(function (r, e) {\n          return r[e] = function (r) {\n            p(n[g.methods[e]], r);\n          }, r;\n        }, {});\n      }(m))), o(V.Provider, {\n        value: m\n      }, void 0 !== k ? o(k, function (n, r) {\n        for (var e = {}, t = {}, u = 0, o = n.length; u < o;) t[n[u]] = 1, u += 1;\n\n        for (var i in r) Object.prototype.hasOwnProperty.call(t, i) || (e[i] = r[i]);\n\n        return e;\n      }([].concat(q, C, L), i), e) : e);\n    }),\n    usePublisher: function (r) {\n      return i(y(p, n.useContext(V)[r]), [r]);\n    },\n    useEmitterValue: function (n) {\n      var r = c(V)[n],\n          e = t(l(h, r)),\n          u = e[0],\n          o = e[1];\n      return b(function () {\n        return s(r, function (n) {\n          n !== u && o(d(n));\n        });\n      }, [r, u]), u;\n    },\n    useEmitter: function (n, r) {\n      var e = c(V)[n];\n      b(function () {\n        return s(e, r);\n      }, [r, e]);\n    }\n  };\n}\n\nexport { j as systemToComponent };","map":{"version":3,"sources":["../src/index.ts"],"names":["keys","obj","result","index","idx","len","length","prop","Object","prototype","hasOwnProperty","call","useIsomorphicLayoutEffect","document","React","useLayoutEffect","useEffect","systemToComponent","systemSpec","map","Root","requiredPropNames","required","optionalPropNames","optional","methodNames","methods","eventNames","events","Context","createContext","applyPropsToSystem","system","props","propsReady","undefined","publish","requiredPropName","optionalPropName","reduce","acc","methodName","value","buildEventHandlers","handlers","eventName","eventHandler","forwardRef","propsWithChildren","ref","children","useState","tap","init","curry1to0","subscribe","values","reset","useImperativeHandle","always","buildMethods","createElement","Provider","omit","key","useCallback","curry2to1","useContext","source","setValue","getValue","next","callback","Component","usePublisher","useEmitterValue","useEmitter"],"mappings":"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","sourcesContent":["/**\n * `@virtuoso.dev/react-urx` exports the [[systemToComponent]] function.\n * It wraps urx systems in to UI **logic provider components**,\n * mapping the system input and output streams to the component input / output points.\n *\n * ### Simple System wrapped as React Component\n *\n * ```tsx\n * const sys = system(() => {\n *   const foo = statefulStream(42)\n *   return { foo }\n * })\n *\n * const { Component: MyComponent, useEmitterValue } = systemToComponent(sys, {\n *   required: { fooProp: 'foo' },\n * })\n *\n * const Child = () => {\n *   const foo = useEmitterValue('foo')\n *   return <div>{foo}</div>\n * }\n *\n * const App = () => {\n *   return <Comp fooProp={42}><Child /><Comp>\n * }\n * ```\n *\n * @packageDocumentation\n */\nimport * as React from 'react'\nimport {\n  ComponentType,\n  createContext,\n  createElement,\n  forwardRef,\n  ForwardRefExoticComponent,\n  ReactNode,\n  RefAttributes,\n  useContext,\n  useImperativeHandle,\n  useState,\n  useCallback,\n} from 'react'\nimport {\n  AnySystemSpec,\n  reset,\n  curry1to0,\n  curry2to1,\n  Emitter,\n  SR,\n  eventHandler,\n  getValue,\n  publish,\n  Publisher,\n  init,\n  StatefulStream,\n  Stream,\n  subscribe,\n  always,\n  tap,\n} from '@virtuoso.dev/urx'\n\n/** @internal */\ninterface Dict<T> {\n  [key: string]: T\n}\n\n/** @internal */\nfunction omit<O extends Dict<any>, K extends readonly string[]>(keys: K, obj: O): Omit<O, K[number]> {\n  const result: Dict<any> = {}\n  const index: Dict<1> = {}\n  let idx = 0\n  const len = keys.length\n\n  while (idx < len) {\n    index[keys[idx]] = 1\n    idx += 1\n  }\n\n  for (const prop in obj) {\n    if (!Object.prototype.hasOwnProperty.call(index, prop)) {\n      result[prop] = obj[prop]\n    }\n  }\n\n  return result as any\n}\n\nconst useIsomorphicLayoutEffect = typeof document !== 'undefined' ? React.useLayoutEffect : React.useEffect\n\n/** @internal */\nexport type Observable<T> = Emitter<T> | Publisher<T>\n\n/**\n * Describes the mapping between the system streams and the component properties.\n * Each property uses the keys as the names of the properties and the values as the corresponding stream names.\n * @typeParam SS the type of the system.\n */\nexport interface SystemPropsMap<SS extends AnySystemSpec, K = keyof SR<SS>, D = { [key: string]: K }> {\n  /**\n   * Specifies the required component properties.\n   */\n  required?: D\n  /**\n   * Specifies the optional component properties.\n   */\n  optional?: D\n  /**\n   * Specifies the component methods, if any. Streams are converted to methods with a single argument.\n   * When invoked, the method publishes the value of the argument to the specified stream.\n   */\n  methods?: D\n  /**\n   * Specifies the component \"event\" properties, if any.\n   * Event properties accept callback functions which get executed when the stream emits a new value.\n   */\n  events?: D\n}\n\n/** @internal */\nexport type PropsFromPropMap<E extends AnySystemSpec, M extends SystemPropsMap<E>> = {\n  [K in Extract<keyof M['required'], string>]: M['required'][K] extends string\n    ? SR<E>[M['required'][K]] extends Observable<infer R>\n      ? R\n      : never\n    : never\n} &\n  {\n    [K in Extract<keyof M['optional'], string>]?: M['optional'][K] extends string\n      ? SR<E>[M['optional'][K]] extends Observable<infer R>\n        ? R\n        : never\n      : never\n  } &\n  {\n    [K in Extract<keyof M['events'], string>]?: M['events'][K] extends string\n      ? SR<E>[M['events'][K]] extends Observable<infer R>\n        ? (value: R) => void\n        : never\n      : never\n  }\n\n/** @internal */\nexport type MethodsFromPropMap<E extends AnySystemSpec, M extends SystemPropsMap<E>> = {\n  [K in Extract<keyof M['methods'], string>]: M['methods'][K] extends string\n    ? SR<E>[M['methods'][K]] extends Observable<infer R>\n      ? (value: R) => void\n      : never\n    : never\n}\n\n/**\n * Used to correctly specify type refs for system components\n *\n * ```tsx\n * const s = system(() => { return { a: statefulStream(0) } })\n * const { Component } = systemToComponent(s)\n *\n * const App = () => {\n *  const ref = useRef<RefHandle<typeof Component>>()\n *  return <Component ref={ref} />\n * }\n * ```\n *\n * @typeParam T the type of the component\n */\nexport type RefHandle<T> = T extends ForwardRefExoticComponent<RefAttributes<infer Handle>> ? Handle : never\n\n/**\n * Converts a system spec to React component by mapping the system streams to component properties, events and methods. Returns hooks for querying and modifying\n * the system streams from the component's child components.\n * @param systemSpec The return value from a [[system]] call.\n * @param map The streams to props / events / methods mapping Check [[SystemPropsMap]] for more details.\n * @param Root The optional React component to render. By default, the resulting component renders nothing, acting as a logical wrapper for its children.\n * @returns an object containing the following:\n *  - `Component`: the React component.\n *  - `useEmitterValue`: a hook that lets child components use values emitted from the specified output stream.\n *  - `useEmitter`: a hook that calls the provided callback whenever the specified stream emits a value.\n *  - `usePublisher`: a hook which lets child components publish values to the specified stream.\n *  <hr />\n */\nexport function systemToComponent<SS extends AnySystemSpec, M extends SystemPropsMap<SS>, S extends SR<SS>, R>(\n  systemSpec: SS,\n  map: M,\n  Root?: R\n) {\n  const requiredPropNames = Object.keys(map.required ?? {})\n  const optionalPropNames = Object.keys(map.optional ?? {})\n  const methodNames = Object.keys(map.methods ?? {})\n  const eventNames = Object.keys(map.events ?? {})\n  const Context = createContext<SR<SS>>(({} as unknown) as any)\n\n  type RootCompProps = R extends ComponentType<infer RP> ? RP : { children?: ReactNode }\n\n  type CompProps = PropsFromPropMap<SS, M> & RootCompProps\n\n  type CompMethods = MethodsFromPropMap<SS, M>\n\n  function applyPropsToSystem(system: ReturnType<SS['constructor']>, props: any) {\n    if (system.propsReady !== undefined) {\n      publish(system.propsReady, false)\n    }\n\n    for (let index = 0; index < requiredPropNames.length; index++) {\n      const requiredPropName = requiredPropNames[index]\n      const stream = system[map.required![requiredPropName]]\n      publish(stream, props[requiredPropName])\n    }\n\n    for (let index = 0; index < optionalPropNames.length; index++) {\n      const optionalPropName = optionalPropNames[index]\n      if (optionalPropName in props) {\n        const stream = system[map.optional![optionalPropName]]\n        publish(stream, props[optionalPropName])\n      }\n    }\n\n    if (system.propsReady !== undefined) {\n      publish(system.propsReady, true)\n    }\n  }\n\n  function buildMethods(system: ReturnType<SS['constructor']>) {\n    return methodNames.reduce((acc, methodName) => {\n      ;(acc as any)[methodName] = (value: any) => {\n        const stream = system[map.methods![methodName]]\n        publish(stream, value)\n      }\n      return acc\n      // eslint-disable-next-line\n    }, {} as CompMethods)\n  }\n\n  function buildEventHandlers(system: ReturnType<SS['constructor']>) {\n    return eventNames.reduce<{ [key: string]: Emitter<any> }>((handlers, eventName) => {\n      handlers[eventName] = eventHandler(system[map.events![eventName]])\n      return handlers\n    }, {})\n  }\n\n  /**\n   * A React component generated from an urx system\n   */\n  const Component = forwardRef<CompMethods, CompProps>((propsWithChildren, ref) => {\n    const { children, ...props } = propsWithChildren as any\n\n    const [system] = useState(() => {\n      return tap(init(systemSpec), system => applyPropsToSystem(system, props))\n    })\n\n    const [handlers] = useState(curry1to0(buildEventHandlers, system))\n\n    useIsomorphicLayoutEffect(() => {\n      for (let index = 0; index < eventNames.length; index++) {\n        const eventName = eventNames[index]\n        if (eventName in props) {\n          subscribe(handlers[eventName], props[eventName])\n        }\n      }\n\n      return () => {\n        Object.values(handlers).map(reset)\n      }\n    }, [props, handlers, system])\n\n    useIsomorphicLayoutEffect(() => {\n      applyPropsToSystem(system, props)\n    })\n\n    useImperativeHandle(ref, always(buildMethods(system)))\n\n    return createElement(\n      Context.Provider,\n      { value: system },\n      Root !== undefined\n        ? createElement(\n            (Root as unknown) as ComponentType,\n            omit([...requiredPropNames, ...optionalPropNames, ...eventNames], props),\n            children\n          )\n        : children\n    )\n  })\n\n  const usePublisher = <K extends keyof S>(key: K) => {\n    return useCallback(curry2to1(publish, React.useContext(Context)[key]), [key]) as (\n      value: S[K] extends Stream<infer R> ? R : never\n    ) => void\n  }\n\n  /**\n   * Returns the value emitted from the stream.\n   */\n  const useEmitterValue = <K extends keyof S, V = S[K] extends StatefulStream<infer R> ? R : never>(key: K) => {\n    const context = useContext(Context)\n    const source: StatefulStream<V> = context[key]\n\n    const [value, setValue] = useState(curry1to0(getValue, source))\n\n    useIsomorphicLayoutEffect(\n      () =>\n        subscribe(source, (next: V) => {\n          if (next !== value) {\n            setValue(always(next))\n          }\n        }),\n      [source, value]\n    )\n\n    return value\n  }\n\n  const useEmitter = <K extends keyof S, V = S[K] extends Stream<infer R> ? R : never>(key: K, callback: (value: V) => void) => {\n    const context = useContext(Context)\n    const source: Stream<V> = context[key]\n    useIsomorphicLayoutEffect(() => subscribe(source, callback), [callback, source])\n  }\n\n  return {\n    Component,\n    usePublisher,\n    useEmitterValue,\n    useEmitter,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}