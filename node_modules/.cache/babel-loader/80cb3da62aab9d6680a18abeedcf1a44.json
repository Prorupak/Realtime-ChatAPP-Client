{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport React from 'react';\nimport emojiRegex from 'emoji-regex';\nimport * as linkify from 'linkifyjs'; //@ts-expect-error\n\nimport findAndReplace from 'mdast-util-find-and-replace';\nimport RootReactMarkdown from 'react-markdown';\nimport ReactMarkdown from 'react-markdown/with-html';\nimport uniqBy from 'lodash.uniqby';\nexport var isOnlyEmojis = function (text) {\n  if (!text) return false;\n  var noEmojis = text.replace(emojiRegex(), '');\n  var noSpace = noEmojis.replace(/[\\s\\n]/gm, '');\n  return !noSpace;\n};\nvar allowedMarkups = ['html', // @ts-expect-error\n'root', 'text', 'break', 'paragraph', 'emphasis', 'strong', 'link', 'list', 'listItem', 'code', 'inlineCode', 'blockquote', 'delete'];\nexport var matchMarkdownLinks = function (message) {\n  var regexMdLinks = /\\[([^[]+)\\](\\(.*\\))/gm;\n  var matches = message.match(regexMdLinks);\n  var singleMatch = /\\[([^[]+)\\]\\((.*)\\)/;\n  var links = matches ? matches.map(function (match) {\n    var i = singleMatch.exec(match);\n    return i && [i[1], i[2]];\n  }) : [];\n  return links.flat();\n};\nexport var messageCodeBlocks = function (message) {\n  var codeRegex = /```[a-z]*\\n[\\s\\S]*?\\n```|`[a-z]*[\\s\\S]*?`/gm;\n  var matches = message.match(codeRegex);\n  return matches || [];\n};\nexport var markDownRenderers = {\n  // eslint-disable-next-line react/display-name\n  link: function (props) {\n    var children = props.children,\n        href = props.href;\n    var isEmail = href === null || href === void 0 ? void 0 : href.startsWith('mailto:');\n    var isUrl = href === null || href === void 0 ? void 0 : href.startsWith('http');\n\n    if (!href || !isEmail && !isUrl) {\n      return children;\n    }\n\n    return React.createElement(\"a\", {\n      className: \"\" + (isUrl ? 'str-chat__message-url-link' : ''),\n      href: href,\n      rel: 'nofollow noreferrer noopener',\n      target: '_blank'\n    }, children);\n  },\n  span: 'span'\n};\nexport var emojiMarkdownPlugin = function () {\n  function replace(match) {\n    return {\n      children: [{\n        type: 'text',\n        value: match\n      }],\n      className: 'inline-text-emoji',\n      type: 'span'\n    };\n  }\n\n  var transform = function (markdownAST) {\n    findAndReplace(markdownAST, emojiRegex(), replace);\n    return markdownAST;\n  };\n\n  return transform;\n};\nexport var mentionsMarkdownPlugin = function (mentioned_users) {\n  return function () {\n    var mentioned_usernames = mentioned_users.map(function (user) {\n      return user.name || user.id;\n    }).filter(Boolean).map(escapeRegExp);\n\n    function replace(match) {\n      var usernameOrId = match.replace('@', '');\n      var user = mentioned_users.find(function (_a) {\n        var id = _a.id,\n            name = _a.name;\n        return name === usernameOrId || id === usernameOrId;\n      });\n      return {\n        children: [{\n          type: 'text',\n          value: match\n        }],\n        mentioned_user: user,\n        type: 'mention'\n      };\n    }\n\n    var transform = function (markdownAST) {\n      if (!mentioned_usernames.length) {\n        return markdownAST;\n      }\n\n      var mentionedUsersRegex = new RegExp(mentioned_usernames.map(function (username) {\n        return \"@\" + username;\n      }).join('|'), 'g');\n      findAndReplace(markdownAST, mentionedUsersRegex, replace);\n      return markdownAST;\n    };\n\n    return transform;\n  };\n};\n\nvar Mention = function (props) {\n  return React.createElement(\"span\", {\n    className: 'str-chat__message-mention'\n  }, props.children);\n};\n\nexport var renderText = function (text, mentioned_users, options) {\n  if (options === void 0) {\n    options = {};\n  } // take the @ mentions and turn them into markdown?\n  // translate links\n\n\n  if (!text) return null;\n  var newText = text;\n  var markdownLinks = matchMarkdownLinks(newText);\n  var codeBlocks = messageCodeBlocks(newText);\n  var detectHttp = /(http(s?):\\/\\/)?(www\\.)?/; // extract all valid links/emails within text and replace it with proper markup\n\n  uniqBy(linkify.find(newText), 'value').forEach(function (_a) {\n    var href = _a.href,\n        type = _a.type,\n        value = _a.value;\n    var linkIsInBlock = codeBlocks.some(function (block) {\n      return block === null || block === void 0 ? void 0 : block.includes(value);\n    }); // check if message is already  markdown\n\n    var noParsingNeeded = markdownLinks && markdownLinks.filter(function (text) {\n      var strippedHref = href === null || href === void 0 ? void 0 : href.replace(detectHttp, '');\n      var strippedText = text === null || text === void 0 ? void 0 : text.replace(detectHttp, '');\n      if (!strippedHref || !strippedText) return false;\n      return strippedHref.includes(strippedText) || strippedText.includes(strippedHref);\n    });\n    if (noParsingNeeded.length > 0 || linkIsInBlock) return;\n    var displayLink = type === 'email' ? value : value.replace(detectHttp, '');\n    newText = newText.replace(new RegExp(escapeRegExp(value), 'g'), \"[\" + displayLink + \"](\" + encodeURI(decodeURI(href)) + \")\");\n  });\n  var plugins = [emojiMarkdownPlugin];\n\n  if (mentioned_users === null || mentioned_users === void 0 ? void 0 : mentioned_users.length) {\n    plugins.push(mentionsMarkdownPlugin(mentioned_users));\n  }\n\n  var renderers = __assign(__assign({\n    mention: Mention\n  }, markDownRenderers), options.customMarkDownRenderers);\n\n  return React.createElement(ReactMarkdown, {\n    allowedTypes: allowedMarkups,\n    escapeHtml: true,\n    plugins: plugins,\n    renderers: renderers,\n    source: newText,\n    transformLinkUri: function (uri) {\n      return uri.startsWith('app://') ? uri : RootReactMarkdown.uriTransformer(uri);\n    },\n    unwrapDisallowed: true\n  });\n};\nexport function escapeRegExp(text) {\n  return text.replace(/[-[\\]{}()*+?.,\\\\^$|#]/g, '\\\\$&');\n}\n\nfunction S4() {\n  return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);\n} // https://stackoverflow.com/a/6860916/2570866\n\n\nexport function generateRandomId() {\n  // prettier-ignore\n  return S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4();\n} // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charAt#getting_whole_characters\n\nexport var getWholeChar = function (str, i) {\n  var code = str.charCodeAt(i);\n  if (Number.isNaN(code)) return '';\n  if (code < 0xd800 || code > 0xdfff) return str.charAt(i);\n\n  if (0xd800 <= code && code <= 0xdbff) {\n    if (str.length <= i + 1) {\n      throw 'High surrogate without following low surrogate';\n    }\n\n    var next = str.charCodeAt(i + 1);\n\n    if (0xdc00 > next || next > 0xdfff) {\n      throw 'High surrogate without following low surrogate';\n    }\n\n    return str.charAt(i) + str.charAt(i + 1);\n  }\n\n  if (i === 0) {\n    throw 'Low surrogate without preceding high surrogate';\n  }\n\n  var prev = str.charCodeAt(i - 1);\n\n  if (0xd800 > prev || prev > 0xdbff) {\n    throw 'Low surrogate without preceding high surrogate';\n  }\n\n  return '';\n};","map":{"version":3,"sources":["/home/rupak/Music/project_medical_pager_chat-master/client/node_modules/stream-chat-react/dist/utils.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","React","emojiRegex","linkify","findAndReplace","RootReactMarkdown","ReactMarkdown","uniqBy","isOnlyEmojis","text","noEmojis","replace","noSpace","allowedMarkups","matchMarkdownLinks","message","regexMdLinks","matches","match","singleMatch","links","map","exec","flat","messageCodeBlocks","codeRegex","markDownRenderers","link","props","children","href","isEmail","startsWith","isUrl","createElement","className","rel","target","span","emojiMarkdownPlugin","type","value","transform","markdownAST","mentionsMarkdownPlugin","mentioned_users","mentioned_usernames","user","name","id","filter","Boolean","escapeRegExp","usernameOrId","find","_a","mentioned_user","mentionedUsersRegex","RegExp","username","join","Mention","renderText","options","newText","markdownLinks","codeBlocks","detectHttp","forEach","linkIsInBlock","some","block","includes","noParsingNeeded","strippedHref","strippedText","displayLink","encodeURI","decodeURI","plugins","push","renderers","mention","customMarkDownRenderers","allowedTypes","escapeHtml","source","transformLinkUri","uri","uriTransformer","unwrapDisallowed","S4","Math","random","toString","substring","generateRandomId","getWholeChar","str","code","charCodeAt","Number","isNaN","charAt","next","prev"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport React from 'react';\nimport emojiRegex from 'emoji-regex';\nimport * as linkify from 'linkifyjs';\n//@ts-expect-error\nimport findAndReplace from 'mdast-util-find-and-replace';\nimport RootReactMarkdown from 'react-markdown';\nimport ReactMarkdown from 'react-markdown/with-html';\nimport uniqBy from 'lodash.uniqby';\nexport var isOnlyEmojis = function (text) {\n    if (!text)\n        return false;\n    var noEmojis = text.replace(emojiRegex(), '');\n    var noSpace = noEmojis.replace(/[\\s\\n]/gm, '');\n    return !noSpace;\n};\nvar allowedMarkups = [\n    'html',\n    // @ts-expect-error\n    'root',\n    'text',\n    'break',\n    'paragraph',\n    'emphasis',\n    'strong',\n    'link',\n    'list',\n    'listItem',\n    'code',\n    'inlineCode',\n    'blockquote',\n    'delete',\n];\nexport var matchMarkdownLinks = function (message) {\n    var regexMdLinks = /\\[([^[]+)\\](\\(.*\\))/gm;\n    var matches = message.match(regexMdLinks);\n    var singleMatch = /\\[([^[]+)\\]\\((.*)\\)/;\n    var links = matches\n        ? matches.map(function (match) {\n            var i = singleMatch.exec(match);\n            return i && [i[1], i[2]];\n        })\n        : [];\n    return links.flat();\n};\nexport var messageCodeBlocks = function (message) {\n    var codeRegex = /```[a-z]*\\n[\\s\\S]*?\\n```|`[a-z]*[\\s\\S]*?`/gm;\n    var matches = message.match(codeRegex);\n    return matches || [];\n};\nexport var markDownRenderers = {\n    // eslint-disable-next-line react/display-name\n    link: function (props) {\n        var children = props.children, href = props.href;\n        var isEmail = href === null || href === void 0 ? void 0 : href.startsWith('mailto:');\n        var isUrl = href === null || href === void 0 ? void 0 : href.startsWith('http');\n        if (!href || (!isEmail && !isUrl)) {\n            return children;\n        }\n        return (React.createElement(\"a\", { className: \"\" + (isUrl ? 'str-chat__message-url-link' : ''), href: href, rel: 'nofollow noreferrer noopener', target: '_blank' }, children));\n    },\n    span: 'span',\n};\nexport var emojiMarkdownPlugin = function () {\n    function replace(match) {\n        return {\n            children: [{ type: 'text', value: match }],\n            className: 'inline-text-emoji',\n            type: 'span',\n        };\n    }\n    var transform = function (markdownAST) {\n        findAndReplace(markdownAST, emojiRegex(), replace);\n        return markdownAST;\n    };\n    return transform;\n};\nexport var mentionsMarkdownPlugin = function (mentioned_users) { return function () {\n    var mentioned_usernames = mentioned_users\n        .map(function (user) { return user.name || user.id; })\n        .filter(Boolean)\n        .map(escapeRegExp);\n    function replace(match) {\n        var usernameOrId = match.replace('@', '');\n        var user = mentioned_users.find(function (_a) {\n            var id = _a.id, name = _a.name;\n            return name === usernameOrId || id === usernameOrId;\n        });\n        return {\n            children: [{ type: 'text', value: match }],\n            mentioned_user: user,\n            type: 'mention',\n        };\n    }\n    var transform = function (markdownAST) {\n        if (!mentioned_usernames.length) {\n            return markdownAST;\n        }\n        var mentionedUsersRegex = new RegExp(mentioned_usernames.map(function (username) { return \"@\" + username; }).join('|'), 'g');\n        findAndReplace(markdownAST, mentionedUsersRegex, replace);\n        return markdownAST;\n    };\n    return transform;\n}; };\nvar Mention = function (props) { return React.createElement(\"span\", { className: 'str-chat__message-mention' }, props.children); };\nexport var renderText = function (text, mentioned_users, options) {\n    if (options === void 0) { options = {}; }\n    // take the @ mentions and turn them into markdown?\n    // translate links\n    if (!text)\n        return null;\n    var newText = text;\n    var markdownLinks = matchMarkdownLinks(newText);\n    var codeBlocks = messageCodeBlocks(newText);\n    var detectHttp = /(http(s?):\\/\\/)?(www\\.)?/;\n    // extract all valid links/emails within text and replace it with proper markup\n    uniqBy(linkify.find(newText), 'value').forEach(function (_a) {\n        var href = _a.href, type = _a.type, value = _a.value;\n        var linkIsInBlock = codeBlocks.some(function (block) { return block === null || block === void 0 ? void 0 : block.includes(value); });\n        // check if message is already  markdown\n        var noParsingNeeded = markdownLinks &&\n            markdownLinks.filter(function (text) {\n                var strippedHref = href === null || href === void 0 ? void 0 : href.replace(detectHttp, '');\n                var strippedText = text === null || text === void 0 ? void 0 : text.replace(detectHttp, '');\n                if (!strippedHref || !strippedText)\n                    return false;\n                return strippedHref.includes(strippedText) || strippedText.includes(strippedHref);\n            });\n        if (noParsingNeeded.length > 0 || linkIsInBlock)\n            return;\n        var displayLink = type === 'email' ? value : value.replace(detectHttp, '');\n        newText = newText.replace(new RegExp(escapeRegExp(value), 'g'), \"[\" + displayLink + \"](\" + encodeURI(decodeURI(href)) + \")\");\n    });\n    var plugins = [emojiMarkdownPlugin];\n    if (mentioned_users === null || mentioned_users === void 0 ? void 0 : mentioned_users.length) {\n        plugins.push(mentionsMarkdownPlugin(mentioned_users));\n    }\n    var renderers = __assign(__assign({ mention: Mention }, markDownRenderers), options.customMarkDownRenderers);\n    return (React.createElement(ReactMarkdown, { allowedTypes: allowedMarkups, escapeHtml: true, plugins: plugins, renderers: renderers, source: newText, transformLinkUri: function (uri) {\n            return uri.startsWith('app://') ? uri : RootReactMarkdown.uriTransformer(uri);\n        }, unwrapDisallowed: true }));\n};\nexport function escapeRegExp(text) {\n    return text.replace(/[-[\\]{}()*+?.,\\\\^$|#]/g, '\\\\$&');\n}\nfunction S4() {\n    return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n// https://stackoverflow.com/a/6860916/2570866\nexport function generateRandomId() {\n    // prettier-ignore\n    return (S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4());\n}\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charAt#getting_whole_characters\nexport var getWholeChar = function (str, i) {\n    var code = str.charCodeAt(i);\n    if (Number.isNaN(code))\n        return '';\n    if (code < 0xd800 || code > 0xdfff)\n        return str.charAt(i);\n    if (0xd800 <= code && code <= 0xdbff) {\n        if (str.length <= i + 1) {\n            throw 'High surrogate without following low surrogate';\n        }\n        var next = str.charCodeAt(i + 1);\n        if (0xdc00 > next || next > 0xdfff) {\n            throw 'High surrogate without following low surrogate';\n        }\n        return str.charAt(i) + str.charAt(i + 1);\n    }\n    if (i === 0) {\n        throw 'Low surrogate without preceding high surrogate';\n    }\n    var prev = str.charCodeAt(i - 1);\n    if (0xd800 > prev || prev > 0xdbff) {\n        throw 'Low surrogate without preceding high surrogate';\n    }\n    return '';\n};\n"]},"metadata":{},"sourceType":"module"}